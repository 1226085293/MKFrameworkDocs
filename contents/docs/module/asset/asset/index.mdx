---
title: Asset
description: 资源的加载、释放、管理
order: 0
---

框架中的 Asset 模块负责资源的加载、释放，并且可以避免

## 加载本地资源

在框架中可以通过 `mk.asset.get` 接口加载本地资源，但是如何用好它节省工作量呢？

```ts
get<T extends Asset>(
    pathStr_: string,
    type_: Constructor<T>,
    target_: MKAsset_.TypeFollowReleaseObject | null,
    config_?: MKAsset_.GetConfig<T>
): Promise<T | null>;
```

这里一共有四个参数，依次说明

1.  `pathStr_`: 资源路径

    #### 路径类型

    路径可以传递多种格式，这里以 `asset/resources/test/image.png` 举例

    1.  全路径：`db://resources/test/image.png`

        这里会默认后`db://`后的第一个`/`前的文本为 bundle 名，示例中为 `resources`

    1.  bundle 内路径：`test/image.png`，但是需要在 `config_` 参数传递 bundle 名，稍后会知道

    #### 路径优化

        除了两种路径格式外，资源路径也做了格外的优化
        - 可传递后缀名： 例如上方举例的路径带有 `.png`，在加载本地资源时框架会自动去除

        - 图片格式补充后缀名：默认情况下，加载图片资源需要带有 `/spriteFrame` 或 `/texture` 后缀，
            如果你没加后缀的情况下，框架会通过第二个 `type_` 参数自动为你添加后缀

2.  `type_`: 资源类型

    例如 Prefab, SpriteFrame, Texture2D 等...

3.  `target_`: 资源跟随释放对象

    不止 `mk.asset`，框架所有加载资源的地方都要求你传递它，例如音频、UI 注册

    什么是 **资源跟随释放对象**？ 资源跟随释放对象的类型是 `MKRelease_.TypeFollowReleaseObject<Asset>`，有两个函数
    ![跟随释放对象类型](/docs/f9dfeba8-7279-4679-848b-baceabf87b20.png)

    followRelease：在资源加载完成时调用，然后由跟随释放对象自己决定什么时候调用资源的 `decRef`，
    目前框架中已扩展的类型有 `mk.LifeCycle` 和 `mk.Bundle_.BundleManageBase`，

    -   `mk.LifeCycle`

        作为 `mk.LifeCycle` 的子类，如果你传递 `mk.ViewBase`, `mk.StaticViewBase`, `mk.SceneDrive` 类型的对象，资源可以在生命周期的 lateClose 中释放

    -   `mk.Bundle_.BundleManageBase`

        这是 bundle 管理器，你可以在下一篇文章中了解它，如果你传递这个类型的对象，资源会在从当前 bundle 的 scene 切换到其他 bundle 的 scene 后，
        资源会被释放

4.  `config_`：加载配置

    | 属性            | 描述                                                                                                                                                                                                                                   |
    | --------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
    | `bundleStr`     | bundle 名，编辑器：resources，运行时：当前场景所属 bundle                                                                                                                                                                              |
    | `progressFunc`  | 进度回调                                                                                                                                                                                                                               |
    | `completedFunc` | 完成回调                                                                                                                                                                                                                               |
    | `remoteOption`  | 远程配置，存在则为远程资源，配置数据参考[官方文档](https://docs.cocos.com/creator/3.8/manual/zh/asset/dynamic-load-resources.html#%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8B%E8%B5%84%E6%BA%90%E5%92%8C%E8%AE%BE%E5%A4%87%E8%B5%84%E6%BA%90) |
    | `retryNum`      | 失败重试次数，默认值为 GlobalConfig.Asset.Config.retryCountOnLoadFailureNum                                                                                                                                                            |

## 加载远程资源

...

## 加载编辑器资源

...

## 加载文件夹资源

...
